# Tempo Helm Chart Values
# Chart: grafana/tempo
# Purpose: Distributed tracing storage

# Single-instance deployment for home lab
tempo:
  replicas: 1

  # Resource limits (30% reduced from requirements)
  resources:
    requests:
      cpu: 140m
      memory: 358Mi
    limits:
      cpu: 700m
      memory: 1.4Gi

  # Tempo configuration
  config: |
    server:
      http_listen_port: 3200

    distributor:
      receivers:
        otlp:
          protocols:
            grpc:
              endpoint: 0.0.0.0:4317
            http:
              endpoint: 0.0.0.0:4318

    ingester:
      trace_idle_period: 10s
      max_block_bytes: 1_000_000
      max_block_duration: 5m

    compactor:
      compaction:
        block_retention: 168h  # 7 days

    storage:
      trace:
        backend: local
        local:
          path: /var/tempo/traces
        wal:
          path: /var/tempo/wal
        pool:
          max_workers: 100
          queue_depth: 10000

    metrics_generator:
      registry:
        external_labels:
          source: tempo
          cluster: k3s-cluster
      storage:
        path: /var/tempo/generator/wal
      traces_storage:
        path: /var/tempo/generator/traces

# Persistent storage using Longhorn
persistence:
  enabled: true
  storageClassName: longhorn
  size: 10Gi

# Service configuration
service:
  type: ClusterIP

# Expose OTLP receivers
serviceOtlp:
  enabled: true

# Monitoring
serviceMonitor:
  enabled: false

# Gateway disabled for single-instance
gateway:
  enabled: false
