# Alloy Helm Chart Values
# Chart: grafana/alloy
# Purpose: Log collection agent (DaemonSet)

# Deploy as DaemonSet (one pod per node)
controller:
  type: daemonset

# Resource limits per pod (30% reduced from requirements)
resources:
  requests:
    cpu: 35m
    memory: 90Mi
  limits:
    cpu: 140m
    memory: 179Mi

# Configuration from ConfigMap
configMap:
  create: false
  name: alloy
  key: config.alloy

# ServiceAccount and RBAC
serviceAccount:
  create: true
  name: alloy

rbac:
  create: true

# ClusterRole permissions to discover pods
clusterRoleRules:
  - apiGroups: [""]
    resources: ["pods", "pods/log", "namespaces", "nodes"]
    verbs: ["get", "list", "watch"]

# Security context (run as root to access logs)
securityContext:
  runAsUser: 0
  runAsGroup: 0
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL

# Host path mounts for log access
extraVolumes:
  - name: varlog
    hostPath:
      path: /var/log
  - name: varlibdockercontainers
    hostPath:
      path: /var/lib/docker/containers

extraVolumeMounts:
  - name: varlog
    mountPath: /var/log
    readOnly: true
  - name: varlibdockercontainers
    mountPath: /var/lib/docker/containers
    readOnly: true

# Service for metrics (Prometheus can scrape)
service:
  enabled: true
  type: ClusterIP
